

@{
    var messages = ViewBag.Messages as List<AfricanShopLviv.BLL.DTO.MessageDto>;
    var users = ViewBag.Users as List<AfricanShopLviv.PL.Models.ApplicationUser>;
    if (messages == null || messages.Count == 0)
    {
        <h4 style="color:red;text-align:center">List of Messages is still Empty...</h4>
    }
    else
    {
        <table class="table table-dark table-hover">
            <thead>
                <tr style="text-align:center">
                    <th scope="col">#</th>
                    <th scope="col">From</th>
                    <th scope="col">Title</th>
                    <th scope="col">Message</th>
                    <th scope="col">Message Date</th>
                    <th scope="col">Status</th>

                </tr>
            </thead>
            <tbody>
                @foreach (var msg in messages)
                {
                    var shortTxtMsg = string.Empty;
                    if (string.IsNullOrEmpty(msg.TextMessage))
                    {
                        msg.TextMessage = string.Empty;
                    }
                    else
                    {
                        shortTxtMsg = msg.TextMessage.Substring(0, 4);
                        if (msg.TextMessage.Count() > 10)
                        {
                            shortTxtMsg = msg.TextMessage.Substring(0, 8);
                        }
                    }
                    var modalId = msg.Id;
                    var sender = users.FirstOrDefault(u => u.UserId == msg.SenderId);
                    var userName = sender.Role == "Guest" ? sender.FirstName : $"{sender.FirstName} { sender.LastName}";
                    var status = msg.IsReviwed == true ? "It has been read" : "Not read";
                    <tr style="text-align:center">
                        <th scope="row">@msg.Id</th>
                        <td>@userName</td>
                        <td>@msg.Title</td>
                        <td>
                            <button class="btn btn-default"
                                    onclick="document.getElementById('id0_@modalId').style.display = 'block'">
                                <span>@shortTxtMsg ...</span> 
                            </button>
                        </td>
                        <td>@msg.DateMessage</td>
                        <td>@status</td>
                    </tr>

                    <!-- Message text details: -->
                    <div style="opacity:1;margin-top:66px" id="id0_@modalId" class="w3-modal">
                        <div class="w3-modal-content w3-animate-zoom w3-card-4">
                            <header class="w3-container w3-teal">
                                @using(Html.BeginForm("OnReadMessage", "Admin", new { msgId = msg.Id  }, FormMethod.Post))
                                {
                                <button type="submit" onclick="document.getElementById('id0_@modalId').style.display='none'"
                                      class="w3-button w3-display-topright">&times;
                                </button>
                                }
                                <h2 style="text-align:center;font-family:'Palatino Linotype'">Text Message Details</h2>
                            </header>
                            <div class="w3-container">
                                    <div class="form-outline">
                                        <textarea name="comment" placeholder="Comments" class="form-control" rows="8" required>
                                            @msg.TextMessage
                                        </textarea>
                                    </div>
                                    <br />
                            </div>
                            <footer style="text-align:center" class="w3-container w3-teal">
                                <h5 style="font-family:'Palatino Linotype';font-weight:bold">
                                MAOTS ent Best Buy Online
                                </h5>
                            </footer>
                        </div>
                    </div>
                }
            </tbody>
        </table>
    } 
}

